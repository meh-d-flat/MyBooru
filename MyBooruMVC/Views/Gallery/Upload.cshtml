@using Microsoft.Extensions.Configuration;
@inject IConfiguration config
@{
    ViewBag.Title = "Upload";
    Layout = "_Layout";
}

<body>
    <form action="@config["ApiHost"]/api/media/upload" method="post" enctype="multipart/form-data" id="file-form">
        <div style="padding-top: 1em">
            <label for="file">Upload File</label>
            <input name="file" type="file" id="file-input" />
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>
    <form action="@config["ApiHost"]/api/media/uploadfrom" method="get" id="uploadfrom-form">
        <div style="margin-top: 10px">
            <label for="source">Url from web</label>
            <input name="source" type="text" />
        </div>
        <button type="submit" class="btn btn-primary">Upload</button>
    </form>
    <script>
        const form = document.getElementById("file-form");
        const fileInput = document.getElementById("file-input");

        fileInput.addEventListener('change', () => {
            form.submit();
        });

        window.addEventListener('paste', e => {
            fileInput.files = e.clipboardData.files;
            alert("File successfully pasted!");
            //fileInput.onchange();
        });


        $(document).on("submit", "#file-form", function (e) {
            e.preventDefault(); //important
            var formData = new FormData(this);

            $.ajax({
                url: "@config["ApiHost"]/api/media/upload",
                method: "POST",
                type: "POST",
                cache: false,
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    alert(response.value.item);
                },
                error: function (jqXHR) {
                    alert(jQuery.parseJSON(jqXHR.responseText).value.item);
                }
            });
        });
    </script>
</body>